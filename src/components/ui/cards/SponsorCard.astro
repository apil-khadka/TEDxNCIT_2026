---
const {
  sponsor,
  tier = 'default',
  size = 'medium',
  isSingle = false,
} = Astro.props as {
  sponsor: {
    id: string
    name: string
    type: string
    description: string
    longDescription?: string
    url?: string
    img: { src: string }
  }
  tier?: 'gold' | 'silver' | 'bronze' | 'community' | 'default'
  size?: 'large' | 'medium' | 'small'
  isSingle?: boolean
}

const isGold = tier === 'gold'
const isCenteredTier = isSingle && (tier === 'bronze' || tier === 'community')

// Tier visual tokens (glow used inside text area)
const tiers = {
  gold: {
    border: 'border-red-500 dark:border-red-400',
    shadow: 'shadow-2xl',
    badge: 'bg-gradient-to-r from-red-600 to-red-500 text-white font-bold',
    titleColor: 'text-red-950 dark:text-red-100',
    descColor: 'text-red-900 dark:text-red-200',
    imgBg: 'bg-white dark:bg-neutral-800/80',
    glow: {
      color:
        'bg-gradient-to-br from-red-300 to-red-400 dark:from-red-700/40 dark:to-red-800/40',
      size: 'w-64 h-64',
      blur: 'blur-3xl',
      opacity: 'opacity-60',
    },
  },
  silver: {
    border: 'border-gray-300 dark:border-gray-400',
    shadow: 'shadow-xl',
    badge: 'bg-gradient-to-r from-gray-300 to-gray-200 text-gray-900 font-bold',
    titleColor: 'text-gray-900 dark:text-gray-100',
    descColor: 'text-gray-700 dark:text-gray-300',
    imgBg: 'bg-white dark:bg-neutral-800/60',
    glow: {
      color:
        'bg-gradient-to-br from-gray-300 to-gray-400 dark:from-gray-700/30 dark:to-gray-600/30',
      size: 'w-48 h-48',
      blur: 'blur-2xl',
      opacity: 'opacity-50',
    },
  },
  bronze: {
    border: 'border-orange-300 dark:border-orange-600',
    shadow: 'shadow-md',
    badge: 'bg-gradient-to-r from-orange-500 to-orange-600 text-white',
    titleColor: 'text-gray-900 dark:text-gray-200',
    descColor: 'text-gray-700 dark:text-gray-400',
    imgBg: 'bg-gray-50 dark:bg-neutral-800/50',
    glow: {
      color:
        'bg-gradient-to-br from-orange-200 to-orange-300 dark:bg-orange-900/10',
      size: 'w-40 h-40',
      blur: 'blur-xl',
      opacity: 'opacity-20',
    },
  },
  community: {
    border: 'border-indigo-400 dark:border-indigo-500',
    shadow: 'shadow-md',
    badge: 'bg-gradient-to-r from-indigo-500 to-purple-600 text-white',
    titleColor: 'text-indigo-900 dark:text-indigo-200',
    descColor: 'text-indigo-700 dark:text-indigo-300',
    imgBg: 'bg-white dark:bg-neutral-800/50',
    glow: {
      color:
        'bg-gradient-to-br from-indigo-100 to-purple-100 dark:from-indigo-900/20 dark:to-purple-900/20',
      size: 'w-36 h-36',
      blur: 'blur-xl',
      opacity: 'opacity-30',
    },
  },
  default: {
    border: 'border-gray-200 dark:border-neutral-700',
    shadow: 'shadow-sm',
    badge: 'bg-gray-500 text-white',
    titleColor: 'text-gray-800 dark:text-gray-200',
    descColor: 'text-gray-600 dark:text-gray-400',
    imgBg: 'bg-gray-50 dark:bg-neutral-900/50',
    glow: {
      color: 'bg-gray-200 dark:bg-gray-800/30',
      size: 'w-32 h-32',
      blur: 'blur-lg',
      opacity: 'opacity-20',
    },
  },
}

const t = tiers[tier as keyof typeof tiers]

// size layout tokens - FIXED HEIGHTS for consistency
const sizes = {
  large: {
    container: 'h-[450px]',
    imageArea: 'h-[280px]',
    textPadding: 'p-10',
    title: 'text-4xl',
  },
  medium: {
    container: 'h-[380px]',
    imageArea: 'h-[180px]',
    textPadding: 'p-6',
    title: 'text-2xl',
  },
  small: {
    container: 'h-[320px]',
    imageArea: 'h-[140px]',
    textPadding: 'p-5',
    title: 'text-xl',
  },
}

const s = sizes[size as keyof typeof sizes]
---

<div class="group relative h-full">
  <!-- CARD with FIXED height -->
  <button
    onclick={`window.openSponsorModal('${sponsor.id}', '${tier}')`}
    class={`relative w-full rounded-2xl border-2 overflow-hidden cursor-pointer transition-all duration-500
      ${t.border} ${t.shadow} bg-white dark:bg-neutral-900 ${s.container}`}
    aria-label={`Open details for ${sponsor.name}`}
  >
    <div
      class="relative z-10 h-full flex flex-col"
    >
      <!-- IMAGE AREA with FIXED height -->
      <div
        class={`flex items-center justify-center flex-shrink-0 ${s.imageArea} ${t.imgBg} w-full`}
      >
        <div
          class="relative flex h-full w-full items-center justify-center overflow-hidden p-6 sm:p-8"
        >
          <img
            src={sponsor.img.src}
            alt={sponsor.name}
            loading="lazy"
            class="max-w-full max-h-full object-contain transform-gpu backface-hidden will-change-transform transition-transform duration-500 group-hover:scale-[1.03]"
          />
        </div>
      </div>

      <!-- TEXT AREA - takes remaining space -->
      <div
        class={`relative flex flex-col justify-center flex-1 w-full ${s.textPadding}
          ${isCenteredTier ? 'items-center text-center' : 'items-start text-left'}
          overflow-hidden`}
      >
        <!-- INTERNAL GLOW -->
        <div
          class={`absolute top-0 right-0 rounded-full
    -translate-x-1/3 -translate-y-1/3
    opacity-0 group-hover:opacity-100
    transition-opacity duration-700
    pointer-events-none
    ${t.glow.color} ${t.glow.size} ${t.glow.blur} ${t.glow.opacity}`}
          aria-hidden="true"></div>

        <!-- CONTENT -->
        <div class="relative z-10 max-w-full">
          <span
            class={`inline-block mb-3 px-3 py-1.5 rounded-full text-xs uppercase tracking-wider ${t.badge}`}
          >
            {sponsor.type}
          </span>

          <h3 class={`font-bold mb-3 ${s.title} ${t.titleColor}`}>
            {sponsor.name}
          </h3>

          <p
            class={`leading-relaxed text-sm ${t.descColor} ${isCenteredTier ? 'max-w-lg mx-auto' : ''}`}
          >
            {sponsor.description}
          </p>

          <div
            class={`mt-6 flex items-center gap-2 font-semibold ${t.titleColor}
              opacity-0 group-hover:opacity-100 transition-all duration-300 translate-y-2 group-hover:translate-y-0`}
          >
            <span>View Details</span>
            <span class="text-xl">â†’</span>
          </div>
        </div>
      </div>
    </div>
  </button>
</div>