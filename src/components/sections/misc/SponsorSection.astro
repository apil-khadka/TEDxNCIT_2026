---
import SponsorCard from '@components/ui/cards/SponsorCard.astro'
import SponsorGrid from '@components/ui/blocks/SponsorGrid.astro'
import SponsorModal from '@components/ui/cards/SponsorModal.astro'

// Types
interface Sponsor {
  id: string
  name: string
  type: string
  description: string
  longDescription: string
  url: string
  img: any
}

interface Props {
  title: string
  tier: 'gold' | 'silver' | 'bronze' | 'community'
  sponsors: Sponsor[]
}

const { title, tier, sponsors } = Astro.props

// Configuration Logic
const isCommunity = tier === 'community'
const isGold = tier === 'gold'
const isSilver = tier === 'silver'
const isBronze = tier === 'bronze'

// Size mapping for SponsorCard
const cardSize = isGold ? 'large' : isSilver ? 'medium' : 'small'

// Theme Map
const tierStyles = {
  gold: {
    icon: 'üèÜ',
    iconColor: 'text-yellow-600 dark:text-yellow-400',
  },
  silver: {
    icon: 'üéñÔ∏è',
    iconColor: 'text-slate-500 dark:text-slate-400',
  },
  bronze: {
    icon: 'üéóÔ∏è',
    iconColor: 'text-orange-600 dark:text-orange-400',
  },
  community: {
    icon: 'üë•',
    iconColor: 'text-red-500 dark:text-red-400',
  },
}

const style = tierStyles[tier]
---

<section class="relative py-12">
  {/* Header */}
  <h2
    class="relative z-10 mb-12 flex items-center justify-center gap-3 text-4xl font-bold text-gray-900 dark:text-neutral-100 md:text-5xl"
  >
    <span class={`text-5xl md:text-6xl ${style.iconColor} drop-shadow-lg`}>
      {style.icon}
    </span>
    {title}
  </h2>

  {/* COMMUNITY TIER (Grid Layout) */}
  {
    isCommunity ? (
      <div class="mx-auto max-w-7xl px-4">
        <SponsorGrid sponsors={sponsors} />
      </div>
    ) : (
      /* GOLD / SILVER / BRONZE TIERS (Static Grid Layout) */
      <div class="relative mx-auto max-w-7xl px-4">
        {/* Gold: 2 columns, Silver: 1 column centered, Bronze: 2 columns */}
        <div
          class={`grid gap-8 ${
            isGold
              ? 'grid-cols-1 lg:grid-cols-2'
              : isSilver
                ? 'grid-cols-1 max-w-4xl mx-auto'
                : 'grid-cols-1 md:grid-cols-2 max-w-5xl mx-auto'
          }`}
        >
          {sponsors.map((s) => (
            <SponsorCard
              sponsor={s}
              tier={tier}
              size={cardSize}
              isSingle={isSilver}
            />
          ))}
        </div>
      </div>
    )
  }

  {/* Render modals */}
  {sponsors.map((s) => <SponsorModal sponsor={s} tier={tier} />)}
</section>

<script>
  // Global modal opener
  declare global {
    interface Window {
      openSponsorModal: (id: string, tier: string) => void
      closeSponsorModal: (id: string) => void
      openModal: (id: string) => void
    }
  }

  window.openSponsorModal = (id: string, tier: string) => {
    const modal = document.getElementById(`modal-${id}`)
    if (modal) {
      modal.classList.remove('hidden')
      modal.setAttribute('data-tier', tier)
      document.body.style.overflow = 'hidden'
    }
  }

  window.closeSponsorModal = (id: string) => {
    const modal = document.getElementById(`modal-${id}`)
    if (modal) {
      modal.classList.add('hidden')
      document.body.style.overflow = 'auto'
    }
  }

  // Legacy support for openModal (used by SponsorCard/Grid)
  window.openModal = (id: string) => {
    const dataEl = document.getElementById(`data-${id}`)
    if (dataEl) {
      const tier = dataEl.getAttribute('data-tier') || 'default'
      window.openSponsorModal(id, tier)
    }
  }
</script>

<style is:global>
    /* Remove any swiper-specific styles */
</style>